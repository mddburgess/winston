openapi: 3.1.1

info:
  title: Winston
  description:
    OpenAPI specification for the Winston backend.
  contact:
    name: Mike Burgess
  license:
    name: MIT Non-AI License
    url: https://github.com/mddburgess/winston/blob/main/LICENSE.md
  version: v1

servers:
  - description: Development
    url: http://localhost:8080

paths:
  /api/v1/channels:
    get:
      summary: List channels
      description:
        Lists the channel data for all the fetched channels.
      tags:
        - Channels
      operationId: list_channels
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "schemas/channels/list-channels-response.yaml"

  /api/v1/channels/{handle}:
    get:
      summary: Get channel
      description:
        Gets the channel data for a single fetched channel.
      tags:
        - Channels
      operationId: get_channel_by_handle
      parameters:
        - name: handle
          description:
            The unique channel handle used in the channel's URL.
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "schemas/channels/channel.yaml"
        "404":
          description:
            The requested channel was not found.
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                notFound:
                  $ref: "examples/channels/get-channel-by-handle-404.yaml"

  /api/v1/channels/{handle}/videos:
    get:
      summary: List videos for channel
      description:
        Lists the video data for all the fetched videos for a single channel.
      tags:
        - Videos
      operationId: list_videos_for_channel
      parameters:
        - name: handle
          description:
            The unique channel handle used in the channel's URL.
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "schemas/videos/list-videos-for-channel-response.yaml"
        "404":
          description:
            The requested channel was not found.
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                notFound:
                  $ref: "examples/videos/list-videos-for-channel-404.yaml"

  /api/v1/videos/{id}:
    get:
      summary: Get video
      description:
        Gets the video data for a single fetched video.
      tags:
        - Videos
      operationId: get_video_by_id
      parameters:
        - name: id
          description:
            The unique identifier for the video.
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "schemas/videos/video.yaml"
        "404":
          description:
            The requested video was not found.
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                notFound:
                  $ref: "examples/videos/get-video-by-id-404.yaml"

  /api/v1/fetch:
    post:
      tags:
        - fetch-controller
      operationId: fetch
      parameters:
        - name: X-Notify-Subscription
          in: header
          required: false
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FetchRequest"
        required: true
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/SseEmitter"
  /api/v2/authors/{authorHandle}:
    get:
      tags:
        - author-controller
      operationId: findAuthorSummary
      parameters:
        - name: authorHandle
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/AuthorSummaryResponse"
  /api/v1/videos/{videoId}/thumbnail:
    get:
      tags:
        - thumbnail-controller
      operationId: getVideoThumbnail
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            image/jpeg:
              schema:
                type: string
                format: byte
  /api/v1/videos/{videoId}/comments:
    get:
      tags:
        - comment-controller
      operationId: listByVideoId
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
        - name: author
          in: query
          required: false
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CommentDto"
  /api/v1/notifications:
    get:
      tags:
        - notifications-controller
      operationId: subscribe
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/SseEmitter"
  /api/v1/fetch/limits:
    get:
      tags:
        - fetch-controller
      operationId: getFetchLimits
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/FetchLimitsResponse"
  /api/v1/channels/{channelId}/thumbnail:
    get:
      tags:
        - thumbnail-controller
      operationId: getChannelThumbnail
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            image/jpeg:
              schema:
                type: string
                format: byte

  /api/v1/authors:
    get:
      tags:
        - author-controller
      operationId: list_1
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/AuthorListResponse"
  /api/v1/authors/{authorId}/thumbnail:
    get:
      tags:
        - thumbnail-controller
      operationId: getAuthorThumbnail
      parameters:
        - name: authorId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            image/jpeg:
              schema:
                type: string
                format: byte
  /api/v1/authors/{authorHandle}:
    get:
      tags:
        - author-controller
      operationId: findAuthorDetails
      parameters:
        - name: authorHandle
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/AuthorDetailsResponse"
      deprecated: true
components:
  schemas:
    Error:
      $ref: "schemas/error.yaml"
    FetchChannel:
      type: object
      properties:
        handle:
          type: string
    FetchComments:
      type: object
      properties:
        videoId:
          type: string
    FetchRange:
      type: object
      properties:
        after:
          type: string
          format: date-time
        before:
          type: string
          format: date-time
    FetchReplies:
      type: object
      properties:
        videoId:
          type: string
        commentId:
          type: string
    FetchRequest:
      type: object
      properties:
        channel:
          $ref: "#/components/schemas/FetchChannel"
        videos:
          $ref: "#/components/schemas/FetchVideos"
        comments:
          $ref: "#/components/schemas/FetchComments"
        replies:
          $ref: "#/components/schemas/FetchReplies"
    FetchVideos:
      type: object
      properties:
        channelId:
          type: string
        fetch:
          type: string
          enum:
            - ALL
            - LATEST
            - RANGE
        range:
          $ref: "#/components/schemas/FetchRange"
    SseEmitter:
      type: object
      properties:
        timeout:
          type: integer
          format: int64
    AuthorDto:
      type: object
      properties:
        id:
          type: string
        displayName:
          type: string
        channelUrl:
          type: string
        profileImageUrl:
          type: string
        statistics:
          $ref: "#/components/schemas/AuthorStatistics"
      required:
        - channelUrl
        - displayName
        - id
        - profileImageUrl
    AuthorStatistics:
      type: object
      properties:
        commentedVideos:
          type: integer
          format: int64
        totalComments:
          type: integer
          format: int64
        totalReplies:
          type: integer
          format: int64
    AuthorSummaryResponse:
      type: object
      properties:
        author:
          $ref: "#/components/schemas/AuthorDto"
        channels:
          type: array
          items:
            $ref: "#/components/schemas/ChannelDto"
        videos:
          type: array
          items:
            $ref: "#/components/schemas/VideoDto"
    ChannelDto:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        customUrl:
          type: string
        thumbnailUrl:
          type: string
        topics:
          type: array
          items:
            type: string
        keywords:
          type: array
          items:
            type: string
        videoCount:
          type: integer
          format: int64
        publishedAt:
          type: string
          format: date-time
        lastFetchedAt:
          type: string
          format: date-time
      required:
        - customUrl
        - description
        - id
        - keywords
        - lastFetchedAt
        - publishedAt
        - thumbnailUrl
        - title
        - topics
        - videoCount
    VideoComments:
      type: object
      properties:
        commentsDisabled:
          type: boolean
        commentCount:
          type: integer
          format: int64
        replyCount:
          type: integer
          format: int64
        totalReplyCount:
          type: integer
          format: int64
        lastFetchedAt:
          type: string
          format: date-time
    VideoDto:
      type: object
      properties:
        id:
          type: string
        channelId:
          type: string
        channel:
          $ref: "#/components/schemas/ChannelDto"
        title:
          type: string
        description:
          type: string
        thumbnailUrl:
          type: string
        comments:
          $ref: "#/components/schemas/VideoComments"
        publishedAt:
          type: string
          format: date-time
        lastFetchedAt:
          type: string
          format: date-time
      required:
        - description
        - id
        - lastFetchedAt
        - publishedAt
        - thumbnailUrl
        - title
    CommentDto:
      type: object
      properties:
        id:
          type: string
        videoId:
          type: string
        author:
          $ref: "#/components/schemas/AuthorDto"
        text:
          type: string
        publishedAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        lastFetchedAt:
          type: string
          format: date-time
        totalReplyCount:
          type: integer
          format: int64
        replies:
          type: array
          items:
            $ref: "#/components/schemas/CommentDto"
      required:
        - author
        - id
        - lastFetchedAt
        - publishedAt
        - replies
        - text
        - totalReplyCount
        - updatedAt
        - videoId
    FetchLimitsResponse:
      type: object
      properties:
        remainingQuota:
          type: integer
          format: int32
    AuthorListResponse:
      type: object
      properties:
        results:
          type: integer
          format: int32
        authors:
          type: array
          items:
            $ref: "#/components/schemas/AuthorDto"
    AuthorDetailsResponse:
      type: object
      properties:
        author:
          $ref: "#/components/schemas/AuthorDto"
        comments:
          type: array
          items:
            $ref: "#/components/schemas/CommentDto"
        videos:
          type: array
          items:
            $ref: "#/components/schemas/VideoDto"
tags:
  - name: Channels
  - name: Videos
